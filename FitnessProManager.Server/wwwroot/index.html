<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitnessPro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        /* --- THEME & RESET --- */
        :root {
            --primary: #6366f1; /* Indigo */
            --primary-hover: #4f46e5;
            --danger: #ef4444;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-muted: #6b7280;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f3f4f6 100%);
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: var(--text-main);
        }

        /* --- CARD STYLES --- */
        .card {
            background: var(--card-bg);
            width: 100%;
            max-width: 420px;
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            animation: fadeIn 0.4s ease-out;
        }

        .dashboard-card {
            max-width: 600px; /* Wider for dashboard */
        }

        h2 {
            text-align: center;
            margin-bottom: 1.5rem;
            font-weight: 600;
            color: #111827;
        }

        /* --- FORMS & INPUTS --- */
        input {
            width: 100%;
            padding: 12px 16px;
            margin-bottom: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 14px;
            box-sizing: border-box;
            transition: all 0.2s;
            outline: none;
        }

            input:focus {
                border-color: var(--primary);
                box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
            }

        /* --- BUTTONS --- */
        button {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: transform 0.1s, background 0.2s;
        }

            button:hover {
                background: var(--primary-hover);
            }

            button:active {
                transform: scale(0.98);
            }

        .btn-secondary {
            background: transparent;
            color: var(--text-muted);
            margin-top: 10px;
            font-weight: 400;
        }

            .btn-secondary:hover {
                background: #f3f4f6;
                color: var(--text-main);
            }

        /* --- DASHBOARD SPECIFIC --- */
        .header-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 15px;
        }

            .header-row h2 {
                margin: 0;
            }

        .logout-btn {
            width: auto;
            background: #fee2e2;
            color: var(--danger);
            padding: 8px 16px;
            font-size: 12px;
        }

            .logout-btn:hover {
                background: #fecaca;
            }

        .add-group {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        .add-btn {
            width: auto;
            white-space: nowrap;
        }

        /* --- WORKOUT LIST --- */
        ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        li {
            background: #f9fafb;
            padding: 16px;
            margin-bottom: 10px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #e5e7eb;
            transition: transform 0.2s;
        }

            li:hover {
                transform: translateY(-2px);
                border-color: var(--primary);
            }

        .workout-title {
            font-weight: 600;
            color: var(--text-main);
            display: block;
        }

        .workout-meta {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .delete-btn {
            width: 32px;
            height: 32px;
            padding: 0;
            background: transparent;
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

            .delete-btn:hover {
                background: #fee2e2;
                color: var(--danger);
            }

        /* --- UTILS --- */
        .hidden {
            display: none !important;
        }

        .error-msg {
            color: var(--danger);
            font-size: 13px;
            text-align: center;
            margin-top: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>

    <div id="loginSection" class="card">
        <h2>üëã Welcome Back</h2>
        <input type="email" id="loginEmail" placeholder="Enter your email">
        <input type="password" id="loginPassword" placeholder="Enter your password">

        <button onclick="handleLogin()">Log In</button>
        <button class="btn-secondary" onclick="showRegister()">Create an account</button>

        <div id="loginError" class="error-msg"></div>
    </div>

    <div id="registerSection" class="card hidden">
        <h2>üöÄ Create Account</h2>
        <input type="text" id="regFirst" placeholder="First Name">
        <input type="text" id="regLast" placeholder="Last Name">
        <input type="email" id="regEmail" placeholder="Email Address">
        <input type="password" id="regPass" placeholder="Choose Password">

        <button onclick="handleRegister()">Sign Up</button>
        <button class="btn-secondary" onclick="showLogin()">Already have an account?</button>

        <div id="regError" class="error-msg"></div>
    </div>

    <div id="dashboardSection" class="card dashboard-card hidden">
        <div class="header-row">
            <h2>üí™ My Workouts</h2>
            <button class="logout-btn" onclick="logout()">Log Out</button>
        </div>

        <div class="add-group">
            <input type="text" id="actInput" placeholder="Activity (e.g. Running)" style="margin:0; flex:2;">
            <input type="number" id="durInput" placeholder="Mins" style="margin:0; width: 80px;">
            <button class="add-btn" onclick="addWorkout()">Add</button>
        </div>

        <ul id="workoutList">
        </ul>
    </div>

    <script>
        // --- CONFIGURATION ---
        const API_URL = "/api";
        let userId = localStorage.getItem("userId");

        // --- NAVIGATION ---
        function showLogin() {
            document.getElementById("loginSection").classList.remove("hidden");
            document.getElementById("registerSection").classList.add("hidden");
            document.getElementById("dashboardSection").classList.add("hidden");
            clearInputs();
        }
        function showRegister() {
            document.getElementById("loginSection").classList.add("hidden");
            document.getElementById("registerSection").classList.remove("hidden");
        }
        function showDashboard() {
            document.getElementById("loginSection").classList.add("hidden");
            document.getElementById("registerSection").classList.add("hidden");
            document.getElementById("dashboardSection").classList.remove("hidden");
            loadWorkouts();
        }
        function clearInputs() {
            document.getElementById("loginError").innerText = "";
            document.getElementById("regError").innerText = "";
            document.querySelectorAll("input").forEach(i => i.value = "");
        }

        // --- AUTH ---
        async function handleLogin() {
            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPassword").value;

            try {
                const res = await fetch(`${API_URL}/auth/login`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ email, password })
                });

                if (res.ok) {
                    const data = await res.json();
                    userId = data.userId;
                    localStorage.setItem("userId", userId);
                    showDashboard();
                } else {
                    const txt = await res.text();
                    document.getElementById("loginError").innerText = "Login Failed: " + txt;
                }
            } catch (err) {
                document.getElementById("loginError").innerText = "Network Error";
            }
        }

        async function handleRegister() {
            const data = {
                firstName: document.getElementById("regFirst").value,
                lastName: document.getElementById("regLast").value,
                email: document.getElementById("regEmail").value,
                password: document.getElementById("regPass").value
            };

            try {
                const res = await fetch(`${API_URL}/auth/register`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                if (res.ok) {
                    alert("Account created! Please log in.");
                    showLogin();
                } else {
                    const txt = await res.text();
                    document.getElementById("regError").innerText = txt;
                }
            } catch (err) {
                document.getElementById("regError").innerText = "Network Error";
            }
        }

        function logout() {
            localStorage.removeItem("userId");
            userId = null;
            showLogin();
        }

        // --- WORKOUTS ---
        async function loadWorkouts() {
            if (!userId) return;
            const list = document.getElementById("workoutList");
            list.innerHTML = "<li style='justify-content:center; color:#888;'>Loading...</li>";

            try {
                const res = await fetch(`${API_URL}/workouts?userId=${userId}`);
                if (res.ok) {
                    const workouts = await res.json();
                    list.innerHTML = "";
                    if (workouts.length === 0) {
                        list.innerHTML = "<li style='justify-content:center; color:#888;'>No workouts yet. Add one!</li>";
                        return;
                    }
                    workouts.forEach(w => {
                        const li = document.createElement("li");
                        li.innerHTML = `
                                <div>
                                    <span class="workout-title">${w.activity}</span>
                                    <span class="workout-meta">Duration: ${w.durationMinutes} mins</span>
                                </div>
                                <button class="delete-btn" title="Delete" onclick="deleteWorkout(${w.id})">üóëÔ∏è</button>
                            `;
                        list.appendChild(li);
                    });
                } else {
                    list.innerHTML = "<li style='color:red'>Failed to load data</li>";
                }
            } catch (err) {
                list.innerHTML = "<li style='color:red'>Server Error</li>";
            }
        }

        async function addWorkout() {
            const activity = document.getElementById("actInput").value;
            const duration = document.getElementById("durInput").value;

            if (!activity || !duration) return;

            await fetch(`${API_URL}/workouts`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    activity,
                    durationMinutes: parseInt(duration),
                    userId: parseInt(userId)
                })
            });

            document.getElementById("actInput").value = "";
            document.getElementById("durInput").value = "";
            loadWorkouts();
        }

        async function deleteWorkout(id) {
            if (!confirm("Are you sure you want to delete this workout?")) return;
            await fetch(`${API_URL}/workouts/${id}`, { method: "DELETE" });
            loadWorkouts();
        }

        // --- INIT ---
        if (userId) showDashboard();
        else showLogin();

    </script>
</body>
</html>